# 📚 راهنمای دیپلوی روی Netlify

## مراحل سریع (خلاصه)

### 1️⃣ آماده‌سازی دیتابیس

1. به [neon.tech](https://neon.tech) بروید
2. یک اکانت بسازید (رایگان)
3. یک پروژه جدید بسازید
4. Connection String را کپی کنید

### 2️⃣ آماده‌سازی فایل‌ها

تمام فایل‌های لازم قبلاً آماده شده‌اند:
- ✅ `netlify.toml` - تنظیمات Netlify
- ✅ `_redirects` - برای ریدایرکت‌ها
- ✅ `netlify/functions/price-api.js` - API functions
- ✅ `.gitignore` - برای جلوگیری از commit کردن فایل‌های غیرضروری

### 3️⃣ بارگذاری به GitHub

```bash
git init
git add .
git commit -m "Ready for Netlify deployment"
git branch -M main
git remote add origin YOUR_GITHUB_REPO_URL
git push -u origin main
```

### 4️⃣ دیپلوی روی Netlify

#### روش الف: از طریق سایت

1. به [netlify.com](https://netlify.com) بروید
2. روی **"Add new site"** → **"Import an existing project"** کلیک کنید
3. GitHub را انتخاب کنید و repository خود را انتخاب کنید
4. تنظیمات:
   - **Build command**: خالی بگذارید
   - **Publish directory**: `.`
5. روی **"Deploy site"** کلیک کنید

#### روش ب: با Netlify CLI

```bash
npm install -g netlify-cli
netlify login
netlify deploy --prod
```

### 5️⃣ تنظیم متغیرهای محیطی

بعد از دیپلوی اولیه:

1. در داشبورد Netlify، به **Site settings** بروید
2. **Environment variables** را باز کنید
3. متغیر زیر را اضافه کنید:

```
Key: DATABASE_URL
Value: ادرس-دیتابیس-شما-از-neon
```

4. **Redeploy** را بزنید

### 6️⃣ تست کردن

بعد از دیپلوی، این آدرس‌ها را تست کنید:

```
https://your-site-name.netlify.app/api/.netlify/functions/price-api/health
```

اگر این پیام را دیدید یعنی موفق بود:
```json
{"success":true,"message":"API is running"}
```

## 📋 فهرست API Endpoints

بعد از دیپلوی، این endpoint ها در دسترس هستند:

```
GET  /api/.netlify/functions/price-api/health
POST /api/.netlify/functions/price-api/clear-database
GET  /api/.netlify/functions/price-api/token-prices?symbol=IAM&hours=24
POST /api/.netlify/functions/price-api/token-prices
GET  /api/.netlify/functions/price-api/point-prices?pointType=binary_points&hours=24
POST /api/.netlify/functions/price-api/point-prices
GET  /api/.netlify/functions/price-api/latest-prices
```

## ⚠️ نکات مهم

### 1. دیتابیس
- از Neon استفاده کنید چون رایگان است
- Connection String باید کامل باشد (شامل SSL)

### 2. Build Settings
```
Build command: (خالی)
Publish directory: .
Functions directory: netlify/functions
```

### 3. Domain شخصی
اگر دامین شخصی دارید، در Netlify:
- Domain settings → Add custom domain
- CNAME فایل هم در پروژه است (`CNAME`)

### 4. به‌روزرسانی
بعد از هر تغییر:
```bash
git add .
git commit -m "Update"
git push
```

Netlify خودکار build و deploy می‌کند.

## 🐛 رفع مشکلات

### خطا: Function not found
**راه حل**: مطمئن شوید `netlify/functions/price-api.js` در GitHub commit شده است.

### خطا: Database connection error
**راه حل**: بررسی کنید `DATABASE_URL` در Environment variables تنظیم شده باشد.

### خطا: Timeout
**راه حل**: Netlify Functions محدودیت زمانی دارند. اگر query خیلی سنگین است، آن را ساده کنید.

## 📞 پشتیبانی

اگر مشکلی دارید:
1. فایل `NETLIFY_DEPLOYMENT.md` را بخوانید (توضیحات تکنیکی)
2. Logs را در Netlify dashboard بررسی کنید
3. تابع price-api.js را بررسی کنید

## ✅ چک‌لیست نهایی

- [ ] دیتابیس Neon ساخته شده
- [ ] فایل‌ها به GitHub push شده‌اند
- [ ] سایت روی Netlify deploy شده
- [ ] DATABASE_URL تنظیم شده
- [ ] API health check کار می‌کند
- [ ] صفحات HTML درست لود می‌شوند

## 🎉 تبریک!

اگر همه چیز کار می‌کند، سایت شما زنده است و آماده استفاده!

